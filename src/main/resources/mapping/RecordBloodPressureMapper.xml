<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yjjk.monitor.mapper.RecordBloodPressureMapper">
    <resultMap id="BaseResultMap" type="com.yjjk.monitor.entity.pojo.RecordBloodPressure">
        <!--
          WARNING - @mbg.generated
        -->
        <result column="id" property="id" jdbcType="INTEGER"/>
        <result column="base_id" property="baseId" jdbcType="INTEGER"/>
        <result column="machine_id" property="machineId" jdbcType="INTEGER"/>
        <result column="record_status" property="recordStatus" jdbcType="INTEGER"/>
        <result column="start_time" property="startTime" jdbcType="VARCHAR"/>
        <result column="end_time" property="endTime" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="created_time" property="createdTime" jdbcType="TIMESTAMP"/>
        <result column="updated_time" property="updatedTime" jdbcType="TIMESTAMP"/>
        <result column="history" property="history" jdbcType="LONGVARCHAR"/>
    </resultMap>

    <select id="getRecordsPeriod" parameterType="java.util.Map"
            resultType="com.yjjk.monitor.entity.VO.StaticsRecordVO">
        SELECT record.start_time,record.end_time,hd.name as departmentName
        FROM record_blood_pressure record
        left join record_base rb
        on record.base_id = rb.id
        LEFT JOIN hospital_bed hb
        ON rb.`bed_id` = hb.`bed_id`
        LEFT JOIN hospital_room hr
        ON hb.`room_id` = hr.`room_id`
        LEFT JOIN hospital_department hd
        ON hr.`department_id` = hd.`department_id`
        WHERE record.status = 0
        and rb.status = 0
        # and hb.status = 0
        # and hr.status = 0
        <if test="getDeleteDepartment == null">
            and hd.status = 0
            and hd.department_id <![CDATA[<>]]> 0
        </if>
        <if test="departmentId != null">
            and hd.department_id = #{departmentId,jdbcType=INTEGER}
        </if>
        <if test="start != null">
            and record.start_time <![CDATA[>=]]> #{start,jdbcType=VARCHAR}
        </if>
        <if test="end != null">
            and record.start_time <![CDATA[<=]]> #{end,jdbcType=VARCHAR}
        </if>
    </select>

    <select id="getHistories" parameterType="java.util.Map"
            resultType="com.yjjk.monitor.entity.history.BloodPressureHistoryData">
        select
        sys,dia,timestamp
        from zs_blood_pressure_info
        <where>
            <if test="machineId != null">
                and `machine_id` = #{machineId,jdbcType=INTEGER}
            </if>
        </where>
        ORDER BY timestamp
    </select>

    <select id="getBloodPressure" parameterType="java.util.Map"
            resultType="com.yjjk.monitor.entity.VO.monitor.MonitorBloodPressureVO">
        SELECT
        rbp.`id` as recordId,
        zbpr.sys,
        zbpr.dia,
        zbpr.update_time as timestamp
        FROM
        record_blood_pressure rbp
        LEFT JOIN
        zs_blood_pressure_real zbpr
        on
        rbp.machine_id = zbpr.`machine_id`
        <where>
            zbpr.update_time <![CDATA[>=]]> rbp.start_time
            <if test="recordId != null">
                and rbp.id = #{recordId,jdbcType=INTEGER}
            </if>
        </where>
    </select>

    <select id="getBattery" parameterType="java.util.Map"
            resultType="java.lang.Integer">
        SELECT
        zmi.battery
        FROM
        record_blood_pressure record
        LEFT JOIN zs_machine_info zmi
        ON record.`machine_id` = zmi.`machine_id`
        <where>
            <if test="recordId != null">
                record.`id` = #{recordId,jdbcType=INTEGER}
            </if>
        </where>
    </select>

</mapper>